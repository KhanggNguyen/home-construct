{% extends "@HomeConstructBuild/SecondOeuvre/base-forms-profiles-secondOeuvre.html.twig" %}

{% block content %}
    {% block button_return %}
        {% if refererIsAForm == true and secondOeuvre.enduitExterieur is defined and secondOeuvre.enduitExterieur is not null %}
            {% set retour = path('home_construct_enduit_exterieur_profile',{'id':secondOeuvre.enduitExterieur.id}) %}
        {% else %}
            {% set retour = app.request.server.get('HTTP_REFERER') %}
        {% endif %}
        <div class="block_button_back">
            <a id="button_back"
               class=" btn btn-xl u-btn-lightblue-v3 g-width-160--md g-font-size-default g-ml-10"
               href="{{ retour }}" data-speed="350">
                <div id="icone_plus_add" class="fas fa-reply"></div>
                Retour
            </a>
        </div>
    {% endblock button_return %}
    {% block sub_content %}
        {{ form_start(form) }}
        <div class="block_profile_with_estimation">
            <div class="col-lg-9 g-mb-50">
                <!-- Info -->
                <div class="g-brd-around g-brd-gray-light-v4 rounded g-pa-30 g-mb-30">
                    <div class="row">
                        <div class="col-12">
                            <span class="d-block">{{ form_row(form.surfaceMur) }}
                                <button type="button" id="import_surface_mur" class="bouton_importer btn btn-sm" data-toggle="tooltip" data-placement="right" data-html="true" title="Ajoutez les murs de la maison pour générer la surface totale des murs extérieurs automatiquement">Génerer la surface du mur existant</button>
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <span class="d-block">{{ form_row(form.typeEnduit) }}</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <span class="d-block">{{ form_row(form.save) }}</span>
                        </div>
                    </div>
                </div>
                <!-- End Info -->
            </div>
            <div class="block_estimation_prix">
                <h4 class="titre_estimation text-center">
                    Estimation
                </h4>
                <h6> <I> Données utilisés : </I></h6>
                <ul class="liste_variables_estimation">
                    <h5 class="titre_sous_entite">
                        <div class="link_sous_entite" href="">
                            Informations sur l'enduit extérieur :
                        </div>
                    </h5>
                    <li>
                                <span id="block_checked_typeEnduit">

                                </span>
                        Prix du type d'enduit exterieur :
                        <b id="prix_type_enduit" class="prixTypeEnduit">

                        </b>
                    </li>
                </ul>
                <div id="prix_calcule" class="block_affichage_prix text-center font-weight-bold g-font-size-30 border-dark border">

                </div>
                <I id="rappel">
                </I>
            </div>
        </div>
        {{ form_end(form) }}
    {% endblock sub_content %}
{% endblock content %}

{% block javascripts %}
    {{ parent()}}
    <script type="text/javascript">
        var data = {{ typeEnduitExterieur|json_encode|raw }};
        jQuery(document).ready(function() {
            $prixEstime = $('#prix_calcule');
            $prixTotal = 0;
            $surfaceMurExterieur = 0;
            {% if elevation is not null and elevation is defined %}
                $surfaceMurExterieur = {{ elevation.calculSurfaceMurExterieur }};
            {% endif %}
            $surfaceMur = $('#homeconstruct_buildbundle_enduitexterieur_surfaceMur');
            $typeEnduit = $('#homeconstruct_buildbundle_enduitexterieur_typeEnduit');
            $prixEstime.html($prixTotal + "€");
            $prixTypeEnduit = null;
            //cas edit $typeTerrassement est définie
            if($typeEnduit.val() != ""){
                $prixTypeEnduit = data[$typeEnduit.val()-1]['prix'];
                $('#prix_type_enduit').html($prixTypeEnduit + "€/m³");
                $prixTotal = calculPrix($surfaceMur, $prixTypeEnduit);
                $prixEstime.html($prixTotal + "€");
            }else{
                $('#prix_type_enduit').html('0');
            }
            //quand on change l'option du select
            $typeEnduit.change(function(){
                if($(this).val() != ""){
                    $prixTypeEnduit = data[$(this).val()-1]['prix'];
                }else{
                    $prixTypeEnduit = 0;
                }
                $('#prix_type_enduit').html($prixTypeEnduit+ "€");
                $prixTotal = calculPrix($surfaceMur, $prixTypeEnduit);
                $prixEstime.html($prixTotal + "€");
            });

            //on click bouton génerer
            $('#import_surface_mur').on('click',function(){

                if($surfaceMurExterieur != 0 && $surfaceMurExterieur != null){
                    $surfaceMur.val($surfaceMurExterieur);
                    if($typeEnduit.val() != ""){
                        $prixTypeEnduit = data[$typeEnduit.val()-1]['prix'];
                    }else{
                        $prixTypeEnduit = 0;
                    }
                    $prixTotal = calculPrix($surfaceMur, $prixTypeEnduit);
                    $prixEstime.html($prixTotal + "€");
                }
            });

            //quand on change input des chiffres
            $('input').on('input', function(){
                if($typeEnduit.val() != ""){
                    $prixTypeEnduit = data[$typeEnduit.val()-1]['prix'];
                }else{
                    $prixTypeEnduit = 0;}
                $prixTotal = calculPrix($(this), $prixTypeEnduit);
                $prixEstime.html($prixTotal + "€");
            });
        });

        function calculPrix($surfaceMur, $prixTypeEnduit){
            if($surfaceMur.val() != "" && $prixTypeEnduit != null){
                $prix = parseFloat($surfaceMur.val()) * parseFloat($prixTypeEnduit);
                return $prix;
            }else{
                return 0;
            }
        }
    </script>
{% endblock javascripts %}