{% extends "@HomeConstructBuild/GrosOeuvre/base-forms-profiles-grosOeuvre.html.twig" %}

{% block body_attributs %}
    onload="tarifFerraillage(),tarifSol(),tarifBeton(),prixTotalMainDoeuvre(),updatePrixTotal()"
{% endblock body_attributs %}

{% block content %}
    {% block button_return %}
        {% if refererIsAForm == true and grosOeuvre.fondation is defined and grosOeuvre.fondation is not null %}
            {% set retour = path('home_construct_fondation_profile',{'id':grosOeuvre.fondation.id}) %}
        {% else %}
            {% set retour = app.request.server.get('HTTP_REFERER') %}
        {% endif %}
        <div class="block_button_back">
            <a id="button_back"
               class=" btn btn-xl u-btn-lightblue-v3 g-width-160--md g-font-size-default g-ml-10"
               href="{{ retour }}" data-speed="350">
                <div  class="fas fa-reply"></div>
                Retour
            </a>
        </div>
    {% endblock button_return %}

    {% block sub_content %}
        <div class="block_form_with_estimation">
                {{ form_start(form) }}
                    <div class="col-lg-9 g-mb-50">
                        <!-- Info -->
                        <div class="g-brd-around g-brd-gray-light-v4 rounded g-pa-30 g-mb-30">

                            <div class="row">
                                <div class="col-12">
                                    <span class="d-block">{{ form_row(form.type) }}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <span class="d-block">{{ form_row(form.prixMainDoeuvre) }}</span>
                                    <p><span id="valeur_tarif"></span>€/m²</p>
                                </div>
                            </div>
                            {% if "ROLE_SUPER_ADMIN" in app.user.roles or "ROLE_ADMIN" in app.user.roles %}
                                <div class="row">
                                    <div class="col-12">
                                        <span class="d-block">{{ form_row(form.ferraillage) }}</span>
                                    </div>
                                </div>
                            {% endif %}
                            <div class="block_button_backnext">
                                <button id="button_next"
                                        class=" btn btn-xl u-btn-lightblue-v3 g-width-160--md g-font-size-default g-ml-10"
                                        href="" data-speed="350">
                                    {% if editMode %}
                                        Enregistrer
                                    {% else %}
                                        Terminé
                                    {% endif %}
                                    <div  class="fas fa-check"></div>
                                </button>
                            </div>
                        </div>
                        <!-- End Info -->
                    </div>
                {{ form_end(form) }}

                <div class="block_estimation_prix_js">
                    <h4 class="titre_estimation text-center">
                        Estimation
                    </h4>
                    <h6> <I> Données utilisés : </I></h6>
                    <ul class="liste_variables_estimation">
                        <h5 class="titre_sous_entite">
                            <a class="link_sous_entite" href="{{ path('home_construct_information_base_profile',{'id':grosOeuvre.informationBase.id}) }}">
                                Informations de base :
                            </a>
                        </h5>
                        <li>
                            <span id="block_checked_surface">
                                <i class="fas fa-check-circle variable-presente"></i>
                            </span>
                            Surface totale de la maison :
                            <b>{{ grosOeuvre.informationBase.surfaceTotale}}m²</b>
                        </li>
                        <h5 class="titre_sous_entite">
                            <a class="link_sous_entite" href="{% if grosOeuvre.etudeSol is defined and grosOeuvre.etudeSol is not null %}
                                    {{ path('home_construct_etude_sol_profile',{'id':grosOeuvre.etudeSol.id}) }}
                                {% else %}
                                    {{ path('home_construct_etude_sol_creation',{'idGrosOeuvre':grosOeuvre.id}) }}
                                {% endif %}
                                ">
                                    Informations Etude du sol :
                             </a>
                        </h5>
                        <li>
                            {% if grosOeuvre.etudeSol is defined and grosOeuvre.etudeSol is not null %}
                                <i class="fas fa-check-circle variable-presente"></i>
                                Type de sol :
                                <b id="type_sol">
                                    {{ grosOeuvre.etudeSol.type.nom }}
                                </b>
                            {% else %}
                                <i class="fas fa-check-circle variable-non-presente"></i>
                                Type de sol :
                                <I> Non renseigné</I>
                            {% endif %}
                        </li>
                        <li>
                            {% if grosOeuvre.etudeSol is defined and grosOeuvre.etudeSol is not null %}
                                <i class="fas fa-check-circle variable-presente"></i>
                                Profondeur du sol choisie :
                                <b id="profondeur_sol">
                                    {{ grosOeuvre.etudeSol.profondeurChoisie }}m
                                </b>
                            {% else %}
                                <i class="fas fa-check-circle variable-non-presente"></i>
                                Profondeur du sol choisie :
                                <I> Non renseigné</I>
                            {% endif %}
                        </li>
                        <h5 class="titre_sous_entite">
                            <a class="link_sous_entite" href="{% if grosOeuvre.soubassement is defined and grosOeuvre.soubassement is not null %}
                                    {{ path('home_construct_soubassement_profile',{'id':grosOeuvre.soubassement.id}) }}
                                {% else %}
                                    {{ path('home_construct_soubassement_creation',{'idGrosOeuvre':grosOeuvre.id}) }}
                                {% endif %}
                                ">
                                Informations Soubassement :
                            </a>
                        </h5>
                        <li>
                            {% if grosOeuvre.soubassement is defined and grosOeuvre.soubassement is not null %}
                                <i class="fas fa-check-circle variable-presente"></i>
                                Type :
                                <b id="type_soubassement">
                                    {{ grosOeuvre.soubassement.type.nom }}
                                </b>
                            {% else %}
                                <i class="fas fa-check-circle variable-non-presente"></i>
                                Type : <I> Non renseigné</I>
                            {% endif %}
                        </li>
                        <h5 class="titre_sous_entite">
                            <div class="link_sous_entite">
                                Résultat :
                            </div>
                        </h5>
                        <li>
                            <span id="block_checked_ferraillage">
                                <i class="fas fa-check-circle variable-presente"></i>
                            </span>
                            Tarif ferraillage :
                            <b id="tarif_ferraillage">

                            </b>
                        </li>
                        <li>
                            <span id="block_checked_beton">
                            </span>
                            Tarif béton :
                            <b id="tarif_beton">

                            </b>
                        </li>
                        <li>
                            <span id="block_checked_sol">
                            </span>
                            Tarif sol :
                            <b id="tarif_sol">

                            </b>
                        </li>
                        <li>
                            <i class="fas fa-check-circle variable-presente"></i>
                            Prix total main d'oeuvre :
                            <b id="total_mainDoeuvre">

                            </b>
                        </li>
                    </ul>
                    <div id="prix_calcule" class="block_affichage_prix text-center font-weight-bold g-font-size-30 border-dark border">

                    </div>
                    <I id="rappel">
                    </I>
                </div>
        </div>

    {% endblock sub_content %}
{% endblock content %}

{% block javascripts %}

<script>
    var slider = document.getElementById("homeconstruct_buildbundle_fondation_prixMainDoeuvre");
    var output = document.getElementById("valeur_tarif");
    var tarifBlockEstimation = document.getElementById("tarif_main_doeuvre");
    output.innerHTML = slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider.oninput = function() {
        output.innerHTML = this.value;
        tarifBlockEstimation.innerHTML=this.value+"€/m²";
    }

</script>
    <script>
        function tarifFerraillage(){
            var surface={{ grosOeuvre.informationBase.surfaceTotale }};
            var tarif= surface*30;
            document.getElementById('tarif_ferraillage').innerHTML=tarif+"€";
            return tarif;
        }
        function tarifBeton(){
            {% if grosOeuvre.etudeSol is defined and grosOeuvre.etudeSol is not null %}
                var profondeur= {{grosOeuvre.etudeSol.profondeurChoisie }};
                var surface={{ grosOeuvre.informationBase.surfaceTotale }};
                document.getElementById('tarif_beton').innerHTML=((90*(surface*profondeur))+300)+"€";
                document.getElementById('block_checked_beton').innerHTML='<i class=\"fas fa-check-circle variable-presente\"></i>';
                return ((90*(surface*profondeur))+300);
            {% else %}
                document.getElementById('tarif_beton').innerHTML="<I>Non calculable</I>";
                document.getElementById('block_checked_beton').innerHTML='<i class=\"fas fa-check-circle variable-non-presente\"></i>';
                return null;
            {% endif %}
        }
        function tarifSol(){
            {% if grosOeuvre.etudeSol is defined and grosOeuvre.etudeSol is not null %}
                var typeSol="{{ grosOeuvre.etudeSol.type.nom }}";
                var surface={{ grosOeuvre.informationBase.surfaceTotale }};
                if(typeSol== 'Argileux'||typeSol=='Sableux'){
                    var tarifSol=500*surface;
                }else{
                    var tarifSol=150*surface;
                }
                {% if grosOeuvre.soubassement is defined and grosOeuvre.soubassement is not null %}
                    var typeSoubassement="{{ grosOeuvre.soubassement.type.nom }}";
                    if(typeSoubassement=='Vide sanitaire'){
                        tarifSol+=150*surface;
                    }
                {% endif %}
                document.getElementById('tarif_sol').innerHTML=tarifSol+"€";
                document.getElementById('block_checked_sol').innerHTML='<i class=\"fas fa-check-circle variable-presente\"></i>';
                return tarifSol;
            {% else %}
                document.getElementById('tarif_sol').innerHTML="<I>Non calculable</I>";
                document.getElementById('block_checked_sol').innerHTML='<i class=\"fas fa-check-circle variable-non-presente\"></i>';
                return null;
            {% endif %}
        }
        function prixTotalMainDoeuvre(){
            var surface={{ grosOeuvre.informationBase.surfaceTotale }};
            var slider=document.getElementById("homeconstruct_buildbundle_fondation_prixMainDoeuvre");
            var tarifMainDoeuvre=slider.value;
            var prixTotal=surface*tarifMainDoeuvre;
            document.getElementById('total_mainDoeuvre').innerHTML=prixTotal+"€";
            return prixTotal;
        }
        function updatePrixTotal(){
            {% if grosOeuvre.etudeSol is defined and grosOeuvre.etudeSol is not null %}
                var prixTotal=tarifSol()+tarifBeton()+tarifFerraillage()+prixTotalMainDoeuvre();
                document.getElementById('prix_calcule').innerHTML=prixTotal+"€";
            {% else %}
                document.getElementById('rappel').innerHTML="Pour pouvoir estimer un prix total veuillez ajouter les entités manquantes (marquées d'un icone rouge)";
            {% endif %}
        }
    </script>

{% endblock javascripts %}



