{% extends "@HomeConstructBuild/Default/layout.html.twig" %}

{% block content %}
    <div class="col g-ml-45 g-ml-0--lg g-pb-65--md">
        <div class="g-pa-20">

            <div class="media g-mb-30">
                <div class="d-flex align-self-center align-items-center">
                    <span class="g-hidden-sm-down g-color-gray-dark-v6 g-mr-12">Etat:</span>
                    <div class="u-select--v1 g-pr-20">
                        <select class="js-select u-select--v1-select w-100" onchange="location = 'http://{{ app.request.server.get("SERVER_NAME") }}{{ path('home_construct_projet_list') }}/'+this.value;">
                            <option value="Tout" data-content='<span class="d-flex align-items-center"><span class="g-hidden-sm-down g-line-height-1_2 g-color-black">Tout</span></span>'
                                    {% if page.sub_title=='Tous vos projets' %}
                            selected
                                    {% endif %}>
                                Tout
                            </option>
                            <option value="En cours" data-content='<span class="d-flex align-items-center"><span class="u-badge-v2--md g-pos-stc g-transform-origin--top-left g-bg-lightblue-v3  g-mr-8--sm"></span><span class="g-hidden-sm-down g-line-height-1_2 g-color-black">En cours</span></span>'
                                    {% if page.sub_title=='Vos projets en cours' %}
                            selected
                                    {% endif %}>
                                En cours
                            </option>
                            <option value="En attente" data-content='<span class="d-flex align-items-center"><span class="u-badge-v2--md g-pos-stc g-transform-origin--top-left g-bg-teal-v2  g-mr-8--sm"></span><span class="g-hidden-sm-down g-line-height-1_2 g-color-black">En attente</span></span>'
                                    {% if page.sub_title=='Vos projets en attente' %}
                            selected
                                    {% endif %}>
                                En attente
                            </option>
                            <option value="Terminé" data-content='<span class="d-flex align-items-center"><span class="u-badge-v2--md g-pos-stc g-transform-origin--top-left g-bg-lightred-v2 g-mr-8--sm"></span><span class="g-hidden-sm-down g-line-height-1_2 g-color-black">Terminé</span></span>'
                                    {% if page.sub_title=='Vos projets terminés' %}
                            selected
                                    {% endif %}>
                                Terminé
                            </option>
                            <option value="Archivé" data-content='<span class="d-flex align-items-center"><span class="u-badge-v2--md g-pos-stc g-transform-origin--top-left g-bg-gray-light-v6 g-mr-8--sm"></span><span class="g-hidden-sm-down g-line-height-1_2 g-color-black">Archivé</span></span>'
                                    {% if page.sub_title=='Vos projets archivés' %}
                            selected
                                    {% endif %}>
                                Archivé
                            </option>
                        </select>
                        <i class="hs-admin-angle-down g-absolute-centered--y g-right-0 g-color-gray-light-v6 ml-auto"></i>
                    </div>
                    <div class="u-select--v1 g-pr-20">
                    </div>
                </div>
                {#
                <div class="media-body align-self-center g-ml-10 g-ml-0--md">
                    <div class="input-group g-pos-rel g-max-width-380 float-right">
                        <input class="form-control g-font-size-default g-brd-gray-light-v7 g-brd-lightblue-v3--focus g-rounded-20 g-pl-20 g-pr-50 g-py-10" type="text" placeholder="Search for project">
                        <button class="btn g-pos-abs g-top-0 g-right-0 g-z-index-2 g-width-60 h-100 g-bg-transparent g-font-size-16 g-color-lightred-v2 g-color-lightblue-v3--hover rounded-0" type="submit">
                            <i class="hs-admin-search g-absolute-centered"></i>
                        </button>
                    </div>
                </div>
                #}
            </div>

            <div class="row">
                {% if object is defined and object is not null and object == 'Projet'%}
                    {% if entities is defined and entities is not null %}
                        {% for entity in entities %}
                            <div class="col-md-6 col-lg-4 g-mb-30">
                                <div class="card h-100 g-brd-gray-light-v7 rounded">
                                    <header class="card-header g-bg-transparent g-brd-bottom-none g-pa-20 g-pa-30--sm">
                                        <div class="media">
                                            <h3 class="g-font-weight-300 g-font-size-20 g-color-black"><a href="{{ path('home_construct_projet_profile',{'id':entity.id}) }}">{{ entity.nom }}</a></h3>
                                            <div class="media-body d-flex justify-content-end">
                                                <div class="g-pos-rel g-z-index-2">
                                                    <a id="dropDown{{ entity.id }}Invoker" class="u-link-v5 g-line-height-0 g-font-size-24 g-color-gray-light-v6 g-color-lightblue-v3--hover" href="#!" aria-controls="dropDown{{ entity.id }}" aria-haspopup="true" aria-expanded="false" data-dropdown-event="click" data-dropdown-target="#dropDown{{ entity.id }}"
                                                       data-dropdown-type="jquery-slide">
                                                        <i class="hs-admin-more-alt g-ml-20"></i>
                                                    </a>

                                                    <div id="dropDown{{ entity.id }}" class="u-shadow-v31 g-pos-abs g-right-0 g-bg-white" aria-labelledby="dropDown{{ entity.id }}Invoker">
                                                        <ul class="list-unstyled g-nowrap mb-0">
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14" href="{{ path('home_construct_projet_edit',{'id':entity.id}) }}">
                                                                    <i class="hs-admin-pencil g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                    Modifier le nom
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14" href="{{ path('home_construct_projet_form_ajout_personne',{'id':entity.id}) }}">
                                                                    <i class="fas fa-plus g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                    Ajouter une personne
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14" href="{{ path('home_construct_projet_pdf',{'id':entity.id}) }}">
                                                                    <i class="fas fa-file-pdf g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                    Exporter au format PDF
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14" href="{{ path('home_construct_projet_etat_change',{'idProjet':entity.id,'etat':'Archivé'}) }}">
                                                                    <i class="hs-admin-archive g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                    Archiver
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14" href="{{ path('home_construct_projet_etat_change',{'idProjet':entity.id,'etat':'En cours'}) }}">
                                                                    <i class="hs-admin-reload g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                    Marquer comme en cours
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14" href="{{ path('home_construct_projet_etat_change',{'idProjet':entity.id,'etat':'Terminé'}) }}">
                                                                    <i class="hs-admin-check g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                    Marquer comme terminé
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14"
                                                                   href="{% if entity.grosOeuvre is defined and entity.grosOeuvre is not null %}
                                                                            {{ path('home_construct_gros_oeuvre_profile', { 'id' : entity.grosOeuvre.id })}}
                                                                         {% else %}
                                                                            {{ path('home_construct_gros_oeuvre_creation', { 'id': entity.id })}}
                                                                         {% endif %}
                                                                        ">
                                                                    {% if entity.grosOeuvre is defined and entity.grosOeuvre is not null  %}
                                                                        <i class="hs-admin-zoom-in g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                        Voir le Gros Oeuvre
                                                                    {% else %}
                                                                        <i class="hs-admin-plus g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                        Ajouter le Gros Oeuvre
                                                                    {% endif %}
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14"
                                                                   href="{% if entity.secondOeuvre is defined and entity.secondOeuvre is not null %}
                                                                            {{ path('home_construct_second_oeuvre_profile', { 'id' : entity.secondOeuvre.id })}}
                                                                         {% else %}
                                                                            {{ path('home_construct_second_oeuvre_creation', { 'id': entity.id })}}
                                                                         {% endif %}
                                                                        ">
                                                                    {% if entity.secondOeuvre is defined and entity.secondOeuvre is not null  %}
                                                                        <i class="hs-admin-zoom-in g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                        Voir le Second Oeuvre
                                                                    {% else %}
                                                                        <i class="hs-admin-plus g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                        Ajouter le Second Oeuvre
                                                                    {% endif %}
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a class="d-flex align-items-center u-link-v5 g-bg-gray-light-v8--hover g-font-size-12 g-font-size-default--md g-color-gray-dark-v6 g-px-25 g-py-14" href="{{ path('home_construct_projet_delete',{'idProjet': entity.id}) }}" onclick="return confirm('Voulez-vous vraiment supprimer le projet ? Attention cette action sera irréversible !')">
                                                                    <i class="hs-admin-trash g-font-size-18 g-color-gray-light-v6 g-mr-10 g-mr-15--md"></i>
                                                                    Supprimer
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% if entity.etat.nom == "En cours" %}
                                            {% set class="g-brd-lightblue-v3 g-bg-lightblue-v3" %}
                                        {% elseif entity.etat.nom == "En attente" %}
                                            {% set class="g-brd-teal-v2 g-bg-teal-v2" %}
                                            {% elseif entity.etat.nom == "Terminé" %}
                                                {% set class="g-brd-lightred-v2 g-bg-lightred-v2" %}
                                                {% elseif entity.etat.nom == "Archivé" %}
                                                    {% set class="g-brd-gray-light-v6 g-bg-gray-light-v6" %}
                                        {% endif %}
                                        <span class="u-tags-v1 text-center g-width-130 g-brd-around {{ class }} g-color-white g-rounded-50 g-py-4 g-px-15">{{ entity.etat.nom }}</span>
                                    </header>

                                    <div class="d-flex justify-content-between g-px-20 g-px-30--sm">
                                        <div>
                                            {% if (entity.secondOeuvre.prix is defined and entity.secondOeuvre.prix is not null) or ((entity.grosOeuvre.prix is defined and entity.grosOeuvre.prix is not null)) %}
                                                <h4 class="g-line-height-1_2 g-font-weight-300 g-font-size-28 g-color-black">
                                                    {{ entity.prix|number_format(2, ',', ' ') }} €
                                                </h4>
                                            {% else %}
                                                <p class="g-line-height-1_2 g-color-black">
                                                    0€
                                                </p>
                                            {% endif %}
                                            <em class="g-font-style-normal g-font-weight-300 g-font-size-16 g-color-gray-dark-v6">
                                                Coût total
                                            </em>
                                        </div>
                                    </div>

                                    <hr class="d-flex g-brd-gray-light-v7 g-mx-20 g-mx-30--sm my-0">
                                    <div class="d-flex justify-content-between g-px-20 g-px-30--sm">
                                        <div>
                                            {% if entity.grosOeuvre.prix is defined and entity.grosOeuvre.prix is not null %}
                                                <h4 class="g-line-height-1_2 g-font-weight-300 g-font-size-28 g-color-black">
                                                    {{ entity.grosOeuvre.prix|number_format(2, ',', ' ') }} €
                                                </h4>
                                            {% else %}
                                                <p class="g-line-height-1_2 g-color-black">
                                                    0€
                                                </p>
                                            {% endif %}
                                            <em class="g-font-style-normal g-font-weight-300 g-font-size-16 g-color-gray-dark-v6">
                                                Gros Oeuvre
                                            </em>
                                        </div>
                                    </div>
                                    <hr class="d-flex g-brd-gray-light-v7 g-mx-20 g-mx-30--sm my-0">
                                    <div class="d-flex justify-content-between g-px-20 g-px-30--sm">
                                        <div>
                                            {% if entity.secondOeuvre.prix is defined and entity.secondOeuvre.prix is not null %}
                                                <h4 class="g-line-height-1_2 g-font-weight-300 g-font-size-28 g-color-black">
                                                    {{ entity.secondOeuvre.prix |number_format(2, ',', ' ') }} €
                                                </h4>
                                            {% else %}
                                                <p class="g-line-height-1_2 g-color-black">
                                                    0€
                                                </p>
                                            {% endif %}
                                            <em class="g-font-style-normal g-font-weight-300 g-font-size-16 g-color-gray-dark-v6">
                                                Second Oeuvre
                                            </em>
                                        </div>
                                    </div>
                                    <hr class="d-flex g-brd-gray-light-v7 g-mx-20 g-mx-30--sm my-0">
                                    <div class=" g-px-20 g-px-30--sm">
                                        <h5 class="g-font-size-default g-color-gray-dark-v6 g-mb-5">Date de création</h5>
                                        <p class="g-color-black mb-0">{{ entity.dateCreation|date('d/m/Y H:i') }}</p>
                                    </div>
                                    <div class="g-px-20 g-px-30--sm">
                                        <h5 class="g-font-size-default g-color-gray-dark-v6 g-mb-5">Créateur</h5>
                                        <p class="g-color-black mb-0">
                                            {% if entity.createur is defined and entity.createur is not null %}
                                                {{ entity.createur.username }}
                                            {% else %}
                                                <I>Utilisateur supprimé</I>
                                            {% endif %}
                                        </p>
                                    </div>
                                    <div id="block_button_persRelies">
                                        <a id="button_liste_personnes" data-toggle="tooltip" data-placement="right" data-html="true" title="Voir la liste des utilisateurs reliés à ce projet"
                                           class="btn btn-xs u-btn-outline-darkgray g-font-size-default rounded" href="{{ path('home_construct_projet_list_users',{'id':entity.id}) }}">
                                            <div class="fas fa-users"></div> Liste des personnes reliés
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                        {% endif %}
                {% endif %}
                    <div class="col-md-6 col-lg-4 g-mb-30">
                        <a class="d-flex align-items-center justify-content-center u-link-v5 g-parent h-100 g-brd-around g-brd-style-dashed g-brd-gray-light-v7 rounded g-pa-30" href="{{ path('home_construct_projet_creation') }}">
                          <span class="text-center">
                          <span class="d-inline-block g-pos-rel g-width-50 g-height-50 g-font-size-default g-color-lightblue-v4 g-brd-around g-brd-lightblue-v4 rounded-circle g-mb-5">
                            <i class="hs-admin-plus g-absolute-centered"></i>
                          </span>
                          <span class="d-block g-font-weight-300 g-font-size-16 g-color-gray-dark-v6 g-color-lightblue-v4--parent-hover">
                              Créer Nouveau Projet
                          </span>
                          </span>
                        </a>
                    </div>
            </div>
        </div>

    </div>

{% endblock content %}
