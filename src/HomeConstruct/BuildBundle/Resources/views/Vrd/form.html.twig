{% extends "@HomeConstructBuild/GrosOeuvre/base-forms-profiles-grosOeuvre.html.twig" %}

{% block body_attributs %}
    {% if "ROLE_SUPER_ADMIN" not in app.user.roles and "ROLE_ADMIN" not in app.user.roles %}
        {% if editMode %}
            onload="prixEauPotable(),prixAssainissement(),prixElectricite(),prixTelephone(),prixGazNaturel(),prixTotal(),fixeTailleTuyaux(),putLastData()"
        {% else %}
            onload="prixEauPotable(),prixAssainissement(),prixElectricite(),prixTelephone(),prixGazNaturel(),prixTotal(),fixeTailleTuyaux()"
        {% endif %}
    {% else %}
        {% if editMode %}
            onload="prixEauPotable(),prixAssainissement(),prixElectricite(),prixTelephone(),prixGazNaturel(),prixTotal(),putLastData()"
        {% else %}
            onload="prixEauPotable(),prixAssainissement(),prixElectricite(),prixTelephone(),prixGazNaturel(),prixTotal()"
        {% endif %}
    {% endif %}
{% endblock %}

{% block content %}
    {% block button_return %}
        {% if refererIsAForm == true and grosOeuvre.vrd is defined and grosOeuvre.vrd is not null %}
            {% set retour = path('home_construct_vrd_profile',{'id':grosOeuvre.vrd.id}) %}
        {% else %}
            {% set retour = app.request.server.get('HTTP_REFERER') %}
        {% endif %}
        <div class="block_button_back">
            <a id="button_back"
               class=" btn btn-xl u-btn-lightblue-v3 g-width-160--md g-font-size-default g-ml-10"
               href="{{ retour }}" data-speed="350">
                <div  class="fas fa-reply"></div>
                Retour
            </a>
        </div>
    {% endblock button_return %}

    {% block sub_content %}
        <div class="block_form_with_estimation">
                {{ form_start(form) }}
                    <div class="col-lg-9 g-mb-50">
                        <!-- Info -->
                        <div class="g-brd-around g-brd-gray-light-v4 rounded g-pa-30 g-mb-30">

                            <div class="row">
                                <div class="col-12">
                                    <span class="d-block">{{ form_row(form.reseauEauPotable) }}
                                        {% if "ROLE_SUPER_ADMIN" not in app.user.roles and "ROLE_ADMIN" not in app.user.roles %}
                                            <I>La taille des tuyaux généré est une valeur moyenne, elle est seulement modifiable par un professionnel</I>
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <span class="d-block">{{ form_row(form.reseauEauUsee) }}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <span class="d-block">{{ form_row(form.reseauElectrique) }}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <span class="d-block">
                                        <label class="sub_title_form control-label required">
                                            Réseau gaz naturel
                                        </label>
                                        {{ form_row(form.reseauGazNaturel) }}
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <span class="d-block">
                                        <label class="sub_title_form control-label required">
                                            Réseau téléphonique
                                        </label>
                                        {{ form_row(form.prixReseauTelephonique) }}
                                        <div id="warning_number"></div>
                                    </span>
                                </div>
                            </div>
                            <div class="block_button_backnext">
                                <button id="button_next"
                                        class=" btn btn-xl u-btn-lightblue-v3 g-width-160--md g-font-size-default g-ml-10"
                                        href="" data-speed="350">
                                    {% if editMode %}
                                        Enregistrer
                                    {% else %}
                                        Terminé
                                    {% endif %}
                                    <div  class="fas fa-check"></div>
                                </button>
                            </div>
                        </div>
                        <!-- End Info -->
                    </div>
                {{ form_end(form) }}
            <div class="block_estimation_prix_js">
                <h4 class="titre_estimation text-center">
                    Estimation
                </h4>
                <h6> <I> Données utilisés : </I></h6>
                <ul class="liste_variables_estimation">
                    <h5 class="titre_sous_entite">
                        <a class="link_sous_entite" href="{{ path('home_construct_information_base_profile',{'id':grosOeuvre.informationBase.id}) }}">
                            Informations de base :
                        </a>
                    </h5>
                    <li>
                        <i class="fas fa-check-circle variable-presente"></i>
                        Surface totale de la maison :
                        <b>
                            {{ grosOeuvre.informationBase.surfaceTotale|number_format(2, ',', ' ') }}m²
                        </b>
                    </li>
                    <h5 class="titre_sous_entite">
                        <div class="link_sous_entite">
                            Informations VRD :
                        </div>
                    </h5>
                    <li>
                        <i class="fas fa-check-circle variable-presente"></i>
                        Prix eau potable :
                        <b id="prix_eauPotable">
                        </b>
                    </li>
                    <li>
                        <i class="fas fa-check-circle variable-presente"></i>
                        Prix assainissement :
                        <b id="prix_assainissement">

                        </b>
                    </li>
                    <li>
                        <i class="fas fa-check-circle variable-presente"></i>
                        Prix électricité :
                        <b id="prix_electricite">

                        </b>
                    </li>
                    <li>
                        <span id="block_checked_telephone">
                        </span>
                        Prix téléphone :
                        <b id="prix_telephone">

                        </b>
                    </li>
                    <li>
                        <span id="block_checked_gazNaturel">
                        </span>
                        Prix gaz naturel :
                        <b id="prix_gazNaturel">

                        </b>
                    </li>
                </ul>
                <div id="prix_calcule" class="block_affichage_prix text-center font-weight-bold g-font-size-30 border-dark border">

                </div>
                <I id="rappel">
                </I>
            </div>
        </div>

    {% endblock sub_content %}
{% endblock content %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function prixEauPotable(){
            var prixReseauEauPotable=900;
            var surface={{ grosOeuvre.informationBase.surfaceTotale }};
            prixReseauEauPotable+=surface*35;
            document.getElementById('prix_eauPotable').innerHTML=prixReseauEauPotable+"€";
            return prixReseauEauPotable;
        }
        function prixAssainissement(){
            var prixAssainissement=300.0;
            var prixFosseSeptique=1500.0;
            var prixPompeRelevage=1000.0;
            var prixMicroStation=5000.0;
            var prixEtudeHydro=500.0;
            var surface={{ grosOeuvre.informationBase.surfaceTotale }};
            prixAssainissement*=surface;
            var valuePompeRelevage=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_pompeRelevage_0').checked;
            if(valuePompeRelevage == true){
                prixAssainissement+=prixPompeRelevage;
            }
            var valueFosseSeptique=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_fosseSeptique_0').checked;
            if(valueFosseSeptique == true){
                prixAssainissement+=prixFosseSeptique;
            }
            var valueMicroStation=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_microStation_0').checked;
            if(valueMicroStation == true){
                prixAssainissement+=prixMicroStation;
            }
            var valueEtudeHydro=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_etudeHydro_0').checked;
            if(valueEtudeHydro == true){
                prixAssainissement+=prixEtudeHydro;
            }
            document.getElementById('prix_assainissement').innerHTML=prixAssainissement+"€";
            return prixAssainissement;
        }

        function prixElectricite(){
            var prixReseauElectrique=450.0;
            document.getElementById('prix_electricite').innerHTML=prixReseauElectrique+"€";
            return prixReseauElectrique;
        }

        function prixTelephone(){
            var valuePrixTelephone=document.getElementById('homeconstruct_buildbundle_vrd_prixReseauTelephonique').value;
            var valueConvertedInNumber=Number(valuePrixTelephone);
            if(valueConvertedInNumber!=0 && isNaN(valueConvertedInNumber)==false){
                document.getElementById('block_checked_telephone').innerHTML="<i class=\"fas fa-check-circle variable-presente\"></i>";
                document.getElementById('warning_number').innerHTML="";
                document.getElementById('prix_telephone').innerHTML=valueConvertedInNumber+"€";
                //
                return valueConvertedInNumber;
            }else{
                document.getElementById('warning_number').innerHTML="<I>Veuillez entrez un nombre svp </I>";
                document.getElementById('block_checked_telephone').innerHTML="<i class=\"fas fa-check-circle variable-non-presente\"></i>";
                document.getElementById('prix_telephone').innerHTML="<I>Non calculable pour le moment </I>";
                return 0;
            }


            /*}else{

                document.getElementById('block_checked_telephone').innerHTML="<i class=\"fas fa-check-circle variable-non-presente\"></i>";
                document.getElementById('prix_telephone').innerHTML="<I>Non calculable pour le moment </I>";
                return 0;
            }*/
        }

        function prixGazNaturel(){
            var element=document.getElementById('homeconstruct_buildbundle_vrd_reseauGazNaturel');
            var opt = element.options[element.selectedIndex];
            var nomFournisseurSelection = opt.text;
            if(nomFournisseurSelection!=""){
                {% for fournisseur in fournisseursGazNaturel %}
                var nomFournisseur = "{{ fournisseur.nom }}";
                if(nomFournisseur==nomFournisseurSelection){
                    var prixFournisseur = "{{ fournisseur.prixForfait }}";
                }
                {% endfor %}
                prixFournisseur=Number(prixFournisseur);
                document.getElementById('prix_gazNaturel').innerHTML=prixFournisseur+"€";
                document.getElementById('block_checked_gazNaturel').innerHTML="<i class=\"fas fa-check-circle variable-presente\"></i>";
                return prixFournisseur;
            }else{
                document.getElementById('prix_gazNaturel').innerHTML="<I>Non calculable pour le moment</I>";
                document.getElementById('block_checked_gazNaturel').innerHTML="<i class=\"fas fa-check-circle variable-non-presente\"></i>";
                return 0;
            }
        }

        function prixTotal(){
            if(prixTelephone()!=0 && prixGazNaturel()!=0){
                var prixTotal=(prixEauPotable()+prixAssainissement()+prixElectricite()+prixTelephone()+prixGazNaturel());
                document.getElementById('prix_calcule').innerHTML=prixTotal+"€";
            }else if(prixTelephone()!=0){
                var prixTotal=(prixEauPotable()+prixAssainissement()+prixElectricite()+prixTelephone());
                document.getElementById('prix_calcule').innerHTML=prixTotal+"€";
            }else if(prixGazNaturel()!=0){
                var prixTotal=(prixEauPotable()+prixAssainissement()+prixElectricite()+prixGazNaturel());
                document.getElementById('prix_calcule').innerHTML=prixTotal+"€";
            }else{
                var prixTotal=(prixEauPotable()+prixAssainissement()+prixElectricite());
                document.getElementById('prix_calcule').innerHTML=prixTotal+"€";
            }
        }
        {% if "ROLE_SUPER_ADMIN" not in app.user.roles and "ROLE_ADMIN" not in app.user.roles %}
            function fixeTailleTuyaux(){
                var input=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauPotable_tailleTuyaux');
                input.readOnly=true;
                input.value=25;
            }
        {% endif %}
        {% if editMode %}
            function putLastData(){
                var buttonOuiPompe=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_pompeRelevage_0');
                var buttonNonPompe=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_pompeRelevage_1');
                {% if grosOeuvre.vrd.reseauEauUsee.pompeRelevage == true %}
                    buttonOuiPompe.checked=true;
                {% else %}
                    buttonNonPompe.checked=true;
                {% endif %}

                var buttonOuiFosse=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_fosseSeptique_0');
                var buttonNonFosse=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_fosseSeptique_1');
                {% if grosOeuvre.vrd.reseauEauUsee.fosseSeptique == true %}
                    buttonOuiFosse.checked=true;
                {% else %}
                    buttonNonFosse.checked=true;
                {% endif %}

                var buttonOuiStation=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_microStation_0');
                var buttonNonStation=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_microStation_1');
                {% if grosOeuvre.vrd.reseauEauUsee.microStation == true %}
                    buttonOuiStation.checked=true;
                {% else %}
                    buttonNonStation.checked=true;
                {% endif %}

                var buttonOuiEtude=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_etudeHydro_0');
                var buttonNonEtude=document.getElementById('homeconstruct_buildbundle_vrd_reseauEauUsee_etudeHydro_1');
                {% if grosOeuvre.vrd.reseauEauUsee.etudeHydro == true %}
                    buttonOuiEtude.checked=true;
                {% else %}
                    buttonNonEtude.checked=true;
                {% endif %}
            }
        {% endif %}
    </script>

{% endblock javascripts %}


