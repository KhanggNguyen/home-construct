{% extends "@HomeConstructBuild/SecondOeuvre/base-forms-profiles-secondOeuvre.html.twig" %}

{% block content %}
    {% block button_return %}
        {% if refererIsAForm == true and secondOeuvre.plomberies is defined and secondOeuvre.plomberies is not null %}
            {% set retour = path('home_construct_plomberie_list',{'idSecondOeuvre':secondOeuvre.id}) %}
        {% else %}
            {% set retour = app.request.server.get('HTTP_REFERER') %}
        {% endif %}
        <div class="block_button_back">
            <a id="button_back"
               class=" btn btn-xl u-btn-lightblue-v3 g-width-160--md g-font-size-default g-ml-10"
               href="{{ retour }}" data-speed="350">
                <div  class="fas fa-reply"></div>
                Retour
            </a>
        </div>
    {% endblock button_return %}

    {% block sub_content %}
        <div id="block_form_table">
            {{ form_start(form,{'attr':{'id':'form_plomberie'}}) }}
            <div class="row block_profile_with_estimation">
                <div class="col-lg-7 g-mb-50">
                    <!-- Info -->
                    <div class="g-brd-around g-brd-gray-light-v4 rounded g-pa-30 g-mb-30 ">
                        <div class="row">
                            <div id="type" class="col-12">
                                {{ form_row(form.typePlomberie) }}
                            </div>
                        </div>
                        <div class="row">
                            <div id="m2" class="col-12">
                                {{ form_row(form.m2) }}
                            </div>
                        </div>
                        <div class="row">
                            <div id="quantite" class="col-12">
                                {{ form_row(form.quantite) }}
                            </div>
                        </div>
                        <div class="row" id="block_bouton_enregistrer">
                            <div class="col-12">
                                <span class="d-block">{{ form_row(form.save) }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Info -->
                <div class="col-lg-5 block_estimation_prix">
                    <h4 class="titre_estimation text-center">
                        Estimation
                    </h4>
                    <h6> <I> Données utilisés : </I></h6>
                    <ul class="liste_variables_estimation">
                        <h5 class="titre_sous_entite">
                            <div class="link_sous_entite" href="">
                                Informations sur l'isolation :
                            </div>
                        </h5>
                        <div id ="parM2">
                            <li>
                                Prix par m² : <b id="prix_m2"></b>
                            </li>
                            <li>
                                Prix main d'oeuvre par m²:
                                <b id="main_oeuvre_m2">
                                </b>
                            </li>
                        </div>
                        <div id ="parQuantite">
                            <li>
                                Prix par type de salle de bain: <b id="prix_quantite"></b>
                            </li>
                            <li>
                                Prix main d'oeuvre par quantité:
                                <b id="main_oeuvre_quantite">
                                </b>
                            </li>
                        </div>

                    </ul>
                    <div id="prix_calcule" class="block_affichage_prix text-center font-weight-bold g-font-size-30 border-dark border">
                    </div>
                    <I id="rappel">
                    </I>
                </div>
            </div>
            {{ form_end(form) }}
            <div id="table_form_plomberie">
                {{ include('@HomeConstructBuild/Plomberie/complex-table-plomberie.html.twig') }}
            </div>
        </div>
        <div class="block_button_backnext" class="media-body align-self-center">
            <a id="button_back"
               class=" btn btn-xl u-btn-lightblue-v3 g-width-160--md g-font-size-default g-ml-10"
               href="{{ path('home_construct_plomberie_list',{'idSecondOeuvre':secondOeuvre.id}) }}" data-speed="350">
                <div  class="fas fa-reply"></div>
                Terminer
            </a>
        </div>

    {% endblock sub_content %}
{% endblock content %}

{% block javascripts %}
    {{ parent()}}
    <script>
        function showGrey(id) {
            var item = 'champSelect' + id;
            document.getElementById(item).style.backgroundColor = "rgba(142, 142, 142, 0.4)";
        }

        function hideGrey(id) {
            var item = 'champSelect' + id;
            document.getElementById(item).style.backgroundColor = "white";
        }

        jQuery(document).ready(function() {
            $typeSdB = {{ typeSdB|json_encode|raw }};
            $typeChoisi = $('#homeconstruct_buildbundle_plomberie_typePlomberie');

            //à la chargement
            if($typeSdB[$typeChoisi.val()-1]['parM2']){
                $('#prix_m2').html($typeSdB[$typeChoisi.val()-1]['prix']+"€");
                $('#main_oeuvre_m2').html($typeSdB[$typeChoisi.val()-1]['mainOeuvre']+"€");
                $('#parQuantite').removeAttr('style').hide();
                $('#quantite').removeAttr('style').hide();
            }else{
                $('#m2').removeAttr('style').hide();
                $('#parM2').removeAttr('style').hide();
                $('#prix_quantite').html($typeSdB[$typeChoisi.val()-1]['prix']+"€");
                $('#main_oeuvre_quantite').html($typeSdB[$typeChoisi.val()-1]['mainOeuvre']+"€");
            }

            if($('#homeconstruct_buildbundle_plomberie_quantite').val() != "" && !$typeSdB[$typeChoisi.val()-1]['parM2']){
                calculPrixParQuantite($('#homeconstruct_buildbundle_plomberie_quantite').val(),$typeChoisi);
            }

            if($('#homeconstruct_buildbundle_plomberie_m2').val() != "" && $typeSdB[$typeChoisi.val()-1]['parM2']){
                calculPrixParM2($('#homeconstruct_buildbundle_plomberie_m2').val(),$typeChoisi);
            }

            //sur changement des inputs
            $('input').on('input', function(){
                if($typeSdB[$typeChoisi.val()-1]['parM2']){
                    calculPrixParM2($(this).val(),$typeChoisi);
                }else{
                    calculPrixParQuantite($(this).val(),$typeChoisi);
                }
            });

            //sur changement
            $($typeChoisi).on('change', function(){
                if($typeSdB[$(this).val()-1]['parM2']){
                    $('#parQuantite').removeAttr('style').hide();
                    $('#quantite').removeAttr('style').hide();
                    $('#prix_m2').html($typeSdB[$(this).val()-1]['prix']+"€");
                    $('#main_oeuvre_m2').html($typeSdB[$(this).val()-1]['mainOeuvre']+"€");
                    $('#parM2').show();
                    $('#m2').show();
                }else{
                    $('#m2').removeAttr('style').hide();
                    $('#parM2').removeAttr('style').hide();
                    $('#main_oeuvre_quantite').html($typeSdB[$(this).val()-1]['mainOeuvre']+"€");
                    $('#prix_quantite').html($typeSdB[$(this).val()-1]['prix']+"€");
                    $('#quantite').show();
                    $('#parQuantite').show();
                }
            });

            //estimer le prix
            function calculPrixParM2($m2,$typeChoisi){
                $prixTotal = 0;
                if($m2 != ""){
                    $prixTotal = $m2 * $typeSdB[$typeChoisi.val()-1]['prix'] + $m2 * $typeSdB[$typeChoisi.val()-1]['mainOeuvre'];
                }
                $('#prix_calcule').html($prixTotal+"€");
            }

            function calculPrixParQuantite($quantite, $typeChoisi){
                $prixTotal = 0;
                if($quantite != ""){
                    $prixTotal = $quantite * $typeSdB[$typeChoisi.val()-1]['prix'] + $quantite * $typeSdB[$typeChoisi.val()-1]['mainOeuvre'];
                }
                $('#prix_calcule').html($prixTotal+"€");
            }

        });
    </script>
{% endblock javascripts %}

